@model IEnumerable<Help2.DbFolder.Help>
@{
    ViewData["Title"] = "Главное";
}
<link rel="stylesheet" href="~/css/index.css">


<div id="section" class="section">

    <div class="sidebar">
        <p style="margin-bottom: 10px">
            Для этого вам нужно:
        </p>
        <p style="font-size:14px!important;color:darkgreen;">
            1) Выбрать город
        </p>
        <p style="font-size:14px!important;color:darkgreen;">
            2) Выбрать категорию
        </p>
        <p style="font-size:14px!important;color:darkgreen;">
            3) Оставить заявку
        </p>
        <br />
        <hr />
        <br />
        <form>
            <label for="city">Город:</label>
            <select name="city" id="city">
                <option value="0">Все</option>
                @foreach (var g in ViewBag.City)
                {
                    <option value="@g.Id">@g.CityName</option>
                }
            </select>
            <label for="category">Категория:</label>
            <select name="type" id="category">
                <option value="all">Все</option>
                <option value="Базовые потребности">Базовые потребности</option>
                <option value="Медикаменты">Медикаменты</option>
                <option value="Образование">Образование</option>
                <option value="Одежда">Одежда</option>
            </select>
            <button id="search-btn" type="button">Поиск</button>
        </form>

        <div class="tabs">
            <a href="#" class="yellow-tab act-tab"><span>Могу помочь</span></a>
            <a href="#"><span>Нужна помощь</span></a>
            <a href="#" class="green-tab"><span>Уже помогли</span></a>

            <!--еще 2 кнопка-->
            <a>Нужно сделать</a>
            <a>Сделаю</a>
        </div>
    </div>

    <div class="result">
        <div id="yellow-result" class="result-item yellow-result act-result">
            @foreach (var d in Model)
            {
                if (d.Category == "Могу Помочь")
                {
                    <div class="help-block">
                        <div class="help-text">
                            <div class="help-title">@d.Title</div>
                            <p>@d.Info</p>
                        </div>
                        <div class="help-data">
                            <div class="help-title" style="text-decoration:none!important;">@d.UserName</div>
                            <p class="help-city"><span>Город:</span>@d.City.CityName</p>
                            <p class="help-phone"><span>Телефон:</span>@d.PhoneNumber</p>
                            <div class="social">
                                <a href="tel:@d.PhoneNumber" class="telephone">
                                    <i class="fa fa-phone"></i>
                                </a>
                                @if (d.WhatsApp == true)
                                {
                                    <a href="https://wa.me/@d.PhoneNumber" class="whatsapp">
                                        <i class="fa fa-whatsapp"></i>
                                    </a>
                                }
                            </div>
                        </div>
                    </div>
                }
            }
        </div>
        <div id="red-result" class="result-item">
            @foreach (var d in Model)
            {
                if (d.Category == "Нужна Помощь")
                {
                    <div class="help-block">
                        <div class="help-text">
                            <div class="help-title">@d.Title</div>
                            <p>@d.Info</p>
                        </div>
                        <div class="help-data">
                            <div class="help-title" style="text-decoration:none!important;">@d.UserName</div>
                            <p class="help-city"><span>Город:</span>@d.City.CityName</p>
                            <p class="help-phone"><span>Телефон:</span>@d.PhoneNumber</p>
                            <div class="social">
                                @if (d.WhatsApp == true)
                                {
                                    <a href="whatsapp" class="whatsapp">
                                        <i class="fa fa-whatsapp"></i>
                                    </a>
                                }
                                @if (d.Telegram == true)
                                {
                                    <a href="telegram" class="telegram">
                                        <i class="fa fa-telegram"></i>
                                    </a>
                                }
                            </div>
                        </div>
                    </div>
                }
            }
        </div>
        <div id="green-result" class="result-item green-result">
            @foreach (var d in Model)
            {
                if (d.Category == "Уже Помогли")
                {
                    <div class="help-block">
                        <div class="help-text">
                            <div class="help-title">@d.Title</div>
                            <p>@d.Info</p>
                        </div>
                        <div class="help-data">
                            <div class="help-title" style="text-decoration:none!important;">@d.UserName</div>
                            <p class="help-city"><span>Город:</span>@d.City.CityName</p>
                            <p class="help-phone"><span>Телефон:</span>@d.PhoneNumber</p>
                            <div class="social">
                                @if (d.WhatsApp == true)
                                {
                                    <a href="whatsapp" class="whatsapp">
                                        <i class="fa fa-whatsapp"></i>
                                    </a>
                                }
                                @if (d.Telegram == true)
                                {
                                    <a href="telegram" class="telegram">
                                        <i class="fa fa-telegram"></i>
                                    </a>
                                }
                            </div>
                        </div>
                    </div>
                }
            }
        </div>


        <!--Нужно сделать-->
        <div id="green-result" class="result-item green-result">
            @foreach (var d in Model)
            {
                if (d.Category == "Нужно сделать")
                {
                    <div class="help-block">
                        <div class="help-text">
                            <div class="help-title">@d.Title</div>
                            <p>@d.Info</p>
                        </div>
                        <div class="help-data">
                            <div class="help-title" style="text-decoration:none!important;">@d.UserName</div>
                            <p class="help-city"><span>Город:</span>@d.City.CityName</p>
                            <p class="help-phone"><span>Телефон:</span>@d.PhoneNumber</p>
                            <div class="social">
                                @if (d.WhatsApp == true)
                                {
                                    <a href="whatsapp" class="whatsapp">
                                        <i class="fa fa-whatsapp"></i>
                                    </a>
                                }
                                @if (d.Telegram == true)
                                {
                                    <a href="telegram" class="telegram">
                                        <i class="fa fa-telegram"></i>
                                    </a>
                                }
                            </div>
                        </div>
                    </div>
                }
            }
        </div>

        <!--Сделаю-->
        <div id="green-result" class="result-item green-result">
            @foreach (var d in Model)
            {
                if (d.Category == "Сделаю")
                {
                    <div class="help-block">
                        <div class="help-text">
                            <div class="help-title">@d.Title</div>
                            <p>@d.Info</p>
                        </div>
                        <div class="help-data">
                            <div class="help-title" style="text-decoration:none!important;">@d.UserName</div>
                            <p class="help-city"><span>Город:</span>@d.City.CityName</p>
                            <p class="help-phone"><span>Телефон:</span>@d.PhoneNumber</p>
                            <div class="social">
                                @if (d.WhatsApp == true)
                                {
                                    <a href="whatsapp" class="whatsapp">
                                        <i class="fa fa-whatsapp"></i>
                                    </a>
                                }
                                @if (d.Telegram == true)
                                {
                                    <a href="telegram" class="telegram">
                                        <i class="fa fa-telegram"></i>
                                    </a>
                                }
                            </div>
                        </div>
                    </div>
                }
            }
        </div>
    </div>
</div>
<script>
    $(document).ready(function () {
        $('.result').css('min-height', '100vh');

        $('#search-btn').click(async function () {
            $('.result-item').html('<p class="loader" style="padding: 25px">Загрузка...</p>');

            var offset = 0;
            $('html, body').animate({
                scrollTop: $('.result').offset().top - 100
            }, 500);

            let city = $('#city').val();
            let type = $('#category').val();

            //let response = await fetch(`https://localhost:5001/Home/Search?city=${city}&type=${type}`, {
            let response = await fetch(`http://vmeste-zko.kz/Home/Search?city=${city}&type=${type}`, {
                header: {
                    "Content-Type": "application/json",
                    "Accept": "application/json"
                },
            })
            let result = await response.json();
            console.log(result)

            let r;
            result.map(c => {
                var w = c.whatsApp === true ? `<a href="https://wa.me/${c.phoneNumber}" class="whatsapp">
                    <i class="fa fa-whatsapp"></i>
                </a>` : `<span style="display: none;"></span>`;

                r = `<div class="help-block">
                    <div class="help-text">
                        <div class="help-title">${c.title}</div>
                        <p>${c.info}</p>
                    </div>
                    <div class="help-data">
                        <div class="help-title" style="text-decoration:none!important;">${c.userName}</div>
                        <p class="help-city"><span>Город:</span>${c.city.cityName}</p>
                        <p class="help-phone"><span>Телефон:</span>${c.phoneNumber}</p>
                        <div class="social">
                            <a href="tel:${c.phoneNumber}" class="telephone">
                                <i class="fa fa-phone"></i>
                            </a>
                            ${w}
                        </div>
                    </div>
                </div>`;

                if (c.category === 'Могу Помочь') {
                    $('#yellow-result').append(r);
                }
                else if (c.category === 'Нужна Помощь') {
                    $('#red-result').append(r);
                }
                else if (c.category === 'Уже Помогли') {
                    $('#green-result').append(r);
                }
            })
            
            //$('.loader').css('display', 'none');
            $('.loader').remove();


            if ($('.result-item').is(':empty')) {
                $('.result-item').html('<p style="padding: 25px">Еще нет никаких данных!</p>');
            }

            $('html, body').animate({
                scrollTop: $('.result').offset().top - 100
            }, 500);
        })

        $('.tabs > a').click(function (e) {
            e.preventDefault();
            $('.tabs > a').removeClass('act-tab');
            $(this).addClass('act-tab');

            $('.result-item').removeClass('act-result');
            $('.result-item').eq($(this).index()).addClass('act-result');
        });
    });
</script>

